<section class="fade-in">
  <header>
    <div>
      <p class="deck-tree">{{Deck}}</p>
      <p class="sub-deck-name">{{Subdeck}}</p>
      <p class="info-queue">
        <span id="infoQueue">{{info-Queue:}}</span> card | <span id="infoQueue">{{info-Ivl:}}</span> Days |
        <span id="infoQueue">{{info-Reviews:}}</span> Times
      </p>
    </div>
  </header>

  <article class="question-container">
    <div id="questionField" class="question-content">{{Question}}</div>
  </article>

  {{#Tip}}
  <article class="tip-container">
    <div class="custom-button no-select" id="tipButton" onclick="toggle()">
      <span id="textButton">Show Tip</span>
    </div>

    <div class="tip-content hidden" id="tipField">{{Tip}}</div>
  </article>
  {{/Tip}}

  <article class="answer-container">
    <div class="answer-content">[...]</div>
  </article>
  <footer>
    <audio>{{QuestionAudio}}</audio>
  </footer>
</section>
<script>
  var html = {
    get: (elementSelector) => {
      return document.querySelector(elementSelector);
    },
  };

  var toggleButton = html.get("#tipButton");
  var extraField = html.get("#tipField");

  function toggle(string) {
    var visibility = {
      true: {
        state: "visible",
        text: "Hide Tip",
      },
      false: {
        state: "hidden",
        text: "Show Tip",
      },
      isHidden: function (element) {
        return element.classList.contains("hidden");
      },
      apply: function (toggleButton, elementToToggle) {
        var hidden = this.isHidden(elementToToggle);
        var stateHandler = this[hidden];
        toggleButton.innerText = stateHandler.text;
        elementToToggle.classList.toggle("hidden");
      },
    };
    visibility.apply(toggleButton, extraField);
  }

  var replaceStringAndAddClass = (...elementsID) => {
    var patterns = [
      {
        pattern: /(?<class>\w+)[.]\w+[.]\w+[(][)]/g,
        groupName: "class",
        className: "class-color",
      },
      {
        pattern: /(?<fix>\w+)[.]\w+[(][)]/g,
        groupName: "fix",
        className: "const-color",
      },
      {
        pattern: /(?<function>\w+)[(][)]/g,
        groupName: "function",
        className: "function-color",
      },
      {
        pattern: /(?<symbol>\?)/g,
        groupName: "symbol",
        className: "symbols-color",
      },
      {
        pattern: /(?<symbol>\!)/g,
        groupName: "symbol",
        className: "symbols-color",
      },
      {
        pattern: /(?<symbol>\()/g,
        groupName: "symbol",
        className: "symbols-color",
      },
      {
        pattern: /(?<symbol>\))/g,
        groupName: "symbol",
        className: "symbols-color",
      },
    ];

    function customReplace(textElement, matches) {
      matches.forEach((c) => {
        var matches = [...textElement.matchAll(c.pattern)];
        matches.forEach((match) => {
          var value = match.groups[c.groupName];
          textElement = textElement.replace(value, `<span class="${c.className}">${value}</span>`);
        });
      });
      return textElement;
    }

    elementsID.forEach((elementID) => {
      var element = document.getElementById(elementID);
      var textElement = element.innerHTML.trim();
      textElement = customReplace(textElement, patterns);
      element.innerHTML = textElement;
    });
  };
  replaceStringAndAddClass("questionField");

  (function showDescriptionCardType() {
    const cardTypeID = `{{info-Queue:}}`;
    const infoQueueElement = html.get("#infoQueue");
    const cardTypeById = {};
    const cardTypeByText = {
      new: 0,
      learning: 1,
      review: 2,
      reLearning: 3,
    };
    for (let prop in cardTypeByText) {
      cardTypeById[cardTypeByText[prop]] = prop;
    }
    infoQueueElement.innerText = cardTypeById[cardTypeID];
  })();
</script>
