<section>
    <header>
        <div class="deck-tree">
            <p>{{Deck}}</p>
            <p class="sub-deck-name">{{Subdeck}}</p>
        </div>
    </header>

    <article class="articleQuestion">
        <div id="questionField" class="questionField">
            {{Question}}
        </div>
    </article>

    <article class="articleAnswer hidden auto-hidden">
        <div class="answerField">
            <div id="answerField" class="notesChild containerFlex">
                {{Answer}}
            </div>
        </div>
    </article>

    <article class="hidden auto-hidden" style="padding-top: 20px;">
        <picture>{{Image}}</picture>
    </article>

    <article class="extra-container no-select">

        {{#Extra}}
        <div class="customButton no-select" id="toggleButton" onclick="toggle()">
            Show Extra
        </div>

        <div class="hidden" id="extraField">
            <div class="notesChild">
                {{Extra}}
            </div>
        </div>

        {{/Extra}}
    </article>

    <footer>
        <audio style="display:none">{{AnswerAudio}}</audio>
    </footer>
</section>
<script>

    const hiddenElements = [...document.getElementsByClassName("auto-hidden")];
    setTimeout(() => {
        hiddenElements.forEach(c => {
            c.classList.remove("hidden")
            c.classList.add("visible");
        })
    }, 100);

    $('div:has(ul)', 'div:has(ol)').addClass('notesChild');

    const toggleButton = document.getElementById("toggleButton");
    const extraField = document.getElementById("extraField");

    function toggle(string) {
        const visibility = {
            true: {
                state: "visible",
                text: "Hide Extra"
            },
            false: {
                state: "hidden",
                text: "Show Extra"
            },
            isHidden: function (element) {
                console.log(element.className);
                return element.className === "hidden" ? true : false;
            },
            apply: function (toggleButton, elementToToggle) {
                const hidden = this.isHidden(elementToToggle);
                const stateHandler = this[hidden];
                toggleButton.innerText = stateHandler.text;
                elementToToggle.className = stateHandler.state;

            }
        };
        visibility.apply(toggleButton, extraField);
    }

    const replaceStringAndAddClass = (...elementsID) => {
        const mapTextColors = [
            { key: '?', value: 'symbols-color' },
            { key: '(', value: 'symbols-color' },
            { key: ')', value: 'symbols-color' },
            { key: 'Array', value: 'class-color' },
            { key: 'String', value: 'class-color' },
            { key: 'Object', value: 'class-color' },
            { key: 'prototype', value: 'const-color' },
        ]        

        elementsID.forEach((elementID) => {
            const element = document.getElementById(elementID)
            let textElement = element.innerText;
            const match = [...textElement.matchAll(/\w+[.]\w+[.](?<function>\w+)[\(][\)]/g)][0];
            const groupValue = match.groups['function'];            
            textElement = textElement
            .replace(groupValue, `<span class="function-color">${groupValue}</span>`)

            element.innerHTML = textElement;
            mapTextColors.forEach(c => {
                element.innerHTML = element.innerHTML.split(c.key)
                                                     .join(`<span class="${c.value}">${c.key}</span>`)
            });
        })

        elementsID.forEach((elementID) => {
            const element = document.getElementById(elementID)
            mapTextColors.forEach(c => {
                element.innerHTML = element.innerHTML.split(c.key)
                    .join(`<span class="${c.value}">${c.key}</span>`)
            });
        })
    }
    replaceStringAndAddClass('questionField');
</script>