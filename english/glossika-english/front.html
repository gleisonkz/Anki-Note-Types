<section class="fade-in">
    <header>
        <span class="deck-tree">{{Deck}}</span>
        <span class="sub-deck-name">{{Subdeck}}</span>
    </header>

    <article>
        <p id="phrase" class="phrase">
            <span>{{Phrase}}</span>
        </p>
        <div>{{Audio}}</div>
    </article>
    <div id="toggle" class="custom-button no-select" onclick="toggle()">
        Show Expression
    </div>
</section>
<script>
    document.getElementById("phrase").style.visibility = "hidden";
    (function highLightTargetWord() {
        const phraseElement = document.getElementById("phrase");
        const toggleElement = document.getElementById("toggle");
        const target = "{{text:Target}}"

        const index = phraseElement.innerText.toLowerCase().indexOf(target.toLowerCase());
        const original = phraseElement.innerText.substring(index, index + target.length);

        const replacementElements = [
            {
                element: phraseElement,
                searchValue: original,
                classElement: "new-word"
            }
        ]
        const applyStyles = (object) => {
            object.element.innerHTML = object.element.innerText
                .replace(object.searchValue,
                    `<span class="${object.classElement}">${object.searchValue}</span>`
                );
        }
        replacementElements.filter(c => c.searchValue)
            .forEach(object => applyStyles(object));
    })();

    function toggle() {
        const phraseElement = document.getElementById("phrase");
        const toggleElement = document.getElementById("toggle");
        console.log("teste")

        const visibility = {
            true: {
                state: "visible",
                text: "Hide Expression"
            },
            false: {
                state: "hidden",
                text: "Show Expression"
            },
            isHidden: function (element) {
                return element.style.visibility === "hidden" ? true : false;
            },
            apply: function (toggleButton, elementToToggle) {
                const hidden = this.isHidden(elementToToggle);
                const stateHandler = this[hidden];
                elementToToggle.style.visibility = stateHandler.state;
                toggleButton.innerText = stateHandler.text;
            }
        };
        visibility.apply(toggleElement, phraseElement)
    };
</script>